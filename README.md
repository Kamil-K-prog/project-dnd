# Проект стола для игры в DnD

---

## Что это?
    Это мой учебный проект, где я оттачиваю навыки работы с Laravel
Когда-то я заинтересовался темой DnD, и, чтобы не учить кучу правил, провёл тестовую сессию в чате с нейросетью. Мне понравилось, и я решил, что хочу сделать функциональную обёртку и автоматизации, чтобы не писать системный промпт и корректировки. И вот я здесь - начал проект на Laravel 12.

---

## Предполагаемый функционал
 - Регистрация/авторизация
 - Система друзей
 - Лобби (вход по приглашению / коду)
 - Игровые сессии (стол с возможностью расставить фишки на карте и сменять карты, чат, ДМ человек или ИИ)
 - В личном кабинете:
   - Шаблоны персонажей / NPC / предметов
   - Шаблоны игровых сессий
   - Просмотр предыдущих игр

---

## База данных

Она разделена на несколько логических групп сущностей:

#### 1. Основные сущности и Пользователи

*   **`users`**: Хранит информацию о зарегистрированных пользователях (игроках и Мастерах Игры). Включает поле `current_lobby_id` для отслеживания текущего лобби пользователя.
*   **`lobbies`**: Представляет собой "комнаты ожидания", где игроки собираются перед началом игры. Содержит код для подключения и настройки лобби.
*   **`game_sessions`**: Описывает конкретную игровую сессию от начала до конца. Хранит статус игры (подготовка, идет игра, на паузе, завершена), информацию о Мастере (человек или ИИ), активную карту и ссылки на использованный шаблон (если есть).

#### 2. Прототипы (Библиотека Пользователя)

Эти таблицы хранят "чертежи" или шаблоны, которые пользователи (в основном Мастера Игры) создают и могут многократно использовать:

*   **`characters`**: Прототипы персонажей игроков (имя, описание, иконки, JSON-поле `character_sheet` для характеристик).
*   **`npcs`**: Прототипы неигровых персонажей (монстры, торговцы, квестовые персонажи и т.д.). Включают тип NPC, описание, иконки и JSON-поле `sheet` для заметок Мастера/характеристик.
*   **`items`**: Прототипы предметов (оружие, броня, зелья, ловушки, ключи). Включают тип предмета, описание, заметки для Мастера, иконки и JSON-поле `data` для базовых свойств предмета.
*   **`maps`**: Загруженные пользователями игровые карты (изображение, название, размер сетки).
*   **`game_templates`**: Шаблоны готовых приключений. Содержат название, описание, сценарий и связывают воедино карты и предварительно расставленные на них NPC/предметы.

#### 3. Игровые Экземпляры (Существуют в рамках `game_sessions`)

Эти таблицы хранят "живые" копии прототипов, которые существуют и изменяются только во время конкретной игровой сессии:

*   **`game_characters`**: Экземпляр персонажа игрока в текущей игре. Копирует данные из прототипа `characters` и хранит текущее состояние (HP, эффекты в `character_sheet`, статус).
*   **`game_npcs`**: Экземпляр NPC в текущей игре. Копирует данные из прототипа `npcs` и хранит его текущее состояние в игре (например, текущее HP в `sheet`).
*   **`game_items`**: Экземпляр предмета в текущей игре. Копирует данные из прототипа `items` и хранит его текущее состояние (например, оставшиеся заряды в `data`).

#### 4. Токены (Фишки на картах)

*   **`tokens`**: Представляет собой фишку (токен) на игровой карте в *активной* `GameSession`. Использует **полиморфную связь** (`tokenable_id`, `tokenable_type`) для ссылки на `GameCharacter`, `GameNpc` или `GameItem`. Хранит координаты, размер, видимость и `display_data` (JSON) для отображения информации о токене при наведении.
*   **`template_tokens`**: Аналогично `tokens`, но для расстановки фишек в *шаблонах игр* (`game_templates`). Использует **полиморфную связь** (`tokenable_id`, `tokenable_type`) для ссылки на прототипы `Npc` или `Item`. Содержит `display_data` (для редактора шаблонов) и `instance_data` (JSON, для переопределения данных прототипа, которые будут скопированы в игровые экземпляры).

#### 5. Сводные таблицы (Связи "многие-ко-многим")

*   **`game_session_user`**: Связывает пользователей с игровыми сессиями, указывая, кто в какой игре участвовал, в какой роли (игрок/Мастер) и каким `GameCharacter` (если игрок).
*   **`inventory_items`**: Реализует инвентарь игровых персонажей, связывая `GameCharacter` с `GameItem` и указывая количество.
*   **`game_template_map`**: Связывает шаблоны игр (`game_templates`) с картами (`maps`), позволяя использовать несколько карт в одном шаблоне.
*   **`game_session_map`**: Связывает активные игровые сессии (`game_sessions`) с картами (`maps`), которые используются в данной конкретной игре. Позволяет ДМу модифицировать набор карт из шаблона или собирать его с нуля.
*   **`game_template_map_suggested_entities`**: Хранит "предложения" для Мастера Игры о том, какие прототипы `Npc` или `Item` (через **полиморфную связь** `suggestable`) было бы уместно разместить на конкретной ` карте` в рамках определенного `game_template`. Содержит поле `notes` для заметок Мастера.

Все таблицы используют стандартные поля `id`, `created_at`, `updated_at`. Внешние ключи настроены с учетом целостности данных, некоторые используют каскадное удаление. Для полей, представляющих собой состояния или типы, используются PHP Enums, которые в базе данных хранятся как строки.

---

## План развития
Для начала, игру будет вести человек. После того, как всё будет готово, будет интегрирован ИИ для:
 - Рисования фишек/иконок (персонажи, предметы)
 - Генерация сущностей по запросу
 - (Предварительно) В конце игры - AI Overview - хайлайты интересных моментов
 - (Предварительно) ИИ может делать ходы от имени персонажа игрока
 - **Главное** - ведение игры

